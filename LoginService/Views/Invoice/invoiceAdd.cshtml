
@{

    Layout = "~/Views/Shared/_template.cshtml";
    //Layout = null;
}
<style>
    ul.dropdown-content {
        max-height: 200px !important;
    }
</style>
<div class="col xl9 m8 s12">
    <div class="card">
        <div class="card-content px-36">
            <form>
                <!-- header section -->
                <div class="row mb-3">
                    <div class="col xl4 m12 display-flex align-items-center">
                        <h6 class="invoice-number mr-4 mb-5">Invoice#</h6>
                        <input type="text" value="000756">
                    </div>
                    <div class="col xl8 m12">
                        <div class="invoice-date-picker display-flex align-items-center">
                            <div class="display-flex align-items-center">
                                <small>Date Issue: </small>
                                <div class="display-flex ml-4">
                                    <input type="text" class="pickadate mr-2 mb-1" value="08/10/2019">
                                </div>
                            </div>
                            <div class="display-flex align-items-center">
                                <small>Date Due: </small>
                                <div class="display-flex ml-4">
                                    <input type="text" class="pickadate mb-1" value="08/10/2019">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- logo and title -->
                <div class="row mb-3">
                    <div class="col m6 s12 invoice-logo display-flex pt-1 push-m6">
                        <img src="../../../app-assets/images/gallery/pixinvent-logo.png" alt="logo" height="46" width="164" />
                    </div>

                    <div class="col m6 s12 pull-m6">
                       
                        <div class="input-field col m6 s12">
                            <h6>Store</h6>
                            <select id="Store"></select>
                        </div>
                       
                        <div class="input-field col m6 s12">
                            <h6>Customer</h6>
                            <select id="Customer"></select>
                        </div>
                       
                        <div class="input-field col m6 s12">
                            <h6>Tax</h6>
                            <select id="tax1">
                                <option value="10">10%</option>
                                <option value="20">20%</option>
                                <option value="30">30%</option>
                            </select>
                        </div>

                      
                        <div class="input-field col m6 s12">
                            <h6>Discount</h6>
                            <select id="discount1">
                                <option value="5">5%</option>
                                <option value="10">10%</option>
                                <option value="15">15%</option>
                            </select>
                        </div>

                    </div>

                </div>
                <!-- invoice address and contact -->
              
                <!-- product details table-->
                <div class="invoice-product-details mb-3" id="productditail1">
                    <form class="form invoice-item-repeater">
                        <div data-repeater-list="group-a">
                            <div class="mb-2" data-repeater-item>
                                <!-- invoice Titles -->
                                <div class="row mb-1">
                                    <div class="col s3 m4">
                                        <h6 class="m-0">Item</h6>
                                    </div>
                                    <div class="col s3">
                                        <h6 class="m-0">Cost</h6>
                                    </div>
                                    <div class="col s3">
                                        <h6 class="m-0">Qty</h6>
                                    </div>
                                    <div class="col s3 m2">
                                        <h6 class="m-0">Total</h6>
                                    </div>
                                </div>
                                <div class="invoice-item display-flex mb-1">
                                    <div class="invoice-item-filed row pt-1">
                                        <div class="col s12 m4 input-field">
                                            <select class="invoice-item-select browser-default" id="product"></select>
                                        </div>
                                        <div class="col m3 s12 input-field">
                                            <input type="text" id="productPrice1">
                                        </div>
                                        <div class="col m3 s12 input-field">
                                            <input type="text" id="productqty1" value="1">
                                        </div>
                                        <div class="col m2 s12 input-field">
                                            <input type="text" id="productTotal1" value="" disabled>
                                        </div>

                                    </div>

                                </div>
                            </div>
                        </div>
                        <div class="input-field">
                            <button class="btn invoice-repeat-btn" data-repeater-create type="button">
                                <i class="material-icons left">add</i>
                                <span>Add Item</span>
                            </button>
                        </div>
                    </form>
                </div>
                <!-- invoice subtotal -->
                <div class="invoice-subtotal" id="subtotal1">
                    <div class="row">
                        <div class="col m5 s12">
                            <div class="input-field">
                                <input type="text" value="Partial Payment">
                            </div>
                            <div class="input-field">
                                <input type="text" value="Happy to give you a 10% discount.">
                            </div>
                        </div>
                        <div class="col xl4 m7 s12 offset-xl3">
                            <ul>
                                <li class="display-flex justify-content-between">
                                    <span class="invoice-subtotal-title">Subtotal</span>
                                    <h6 class="invoice-subtotal-value">$72.00</h6>
                                </li>
                                <li class="display-flex justify-content-between">
                                    <span class="invoice-subtotal-title">Discount</span>
                                    <h6 class="invoice-subtotal-value">- $ 09.60</h6>
                                </li>
                                <li class="display-flex justify-content-between">
                                    <span class="invoice-subtotal-title">Tax</span>
                                    <h6 class="invoice-subtotal-value">21%</h6>
                                </li>
                                <li>
                                    <div class="divider mt-2 mb-2"></div>
                                </li>
                                <li class="display-flex justify-content-between">
                                    <span class="invoice-subtotal-title">Invoice Total</span>
                                    <h6 class="invoice-subtotal-value">$ 61.40</h6>
                                </li>
                                <li class="display-flex justify-content-between">
                                    <span class="invoice-subtotal-title">Paid to date</span>
                                    <h6 class="invoice-subtotal-value">- $ 00.00</h6>
                                </li>
                                <li class="display-flex justify-content-between">
                                    <span class="invoice-subtotal-title">Balance (USD)</span>
                                    <h6 class="invoice-subtotal-value">$ 10,953</h6>
                                </li>
                                <li class=" mt-2">
                                    <a href="app-invoice-view.html" class="btn btn-block waves-effect waves-light">Preview</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<script>

    $(document).ready(function () {

        //$('#productditail1').hide();
        //$('#subtotal1').hide();

        GetCustomer();
        GetStore();
        GetProduct()

    });

    function GetCustomer() {
        $.ajax({
            url: "/Invoice/GetCustomerList",
            type: "GET",
            success: function (data) {
                debugger
                $('#Customer').empty();
                var htmlstring = '';

                htmlstring = '<option value="" disabled selected>Select Customer</option>'
                if (data.length != 0) {
                    for (var i = 0; i < data.length; i++) {

                        htmlstring += '<option value=' + data[i].CustomerId + ' Selected>' + data[i].CustomerName + '</option>'

                    }
                }
                $('#Customer').html(htmlstring).formSelect();
                //$('#Customer').on('change', function () {
                //    var custId = parseInt($('#Customer').val()) - 1;

                //    $('#customerId').val(data[custId].CustomerId);
                //    $('#customerName1').val(data[custId].CustomerName);
                //    $('#customerAddress1').val(data[custId].CustomerAddress);
                //    $('#customerEmail1').val(data[custId].CustomerEmail);
                //    $('#customerPhone1').val(data[custId].CustomerPhone);

                //});

            },
            error: function (response) {
                M.toast({ html: "Something Went Wrong.", classes: 'rounded toast-danger' });
            },

        });
    }

    function GetStore() {
        $.ajax({
            url: "/Invoice/GetStoreList",
            type: "GET",
            success: function (data) {
                debugger
                $('#Store').empty();
                var htmlstring = '';

                htmlstring = '<option value="" disabled selected>Select Customer</option>'
                if (data.length != 0) {
                    for (var i = 0; i < data.length; i++) {

                        htmlstring += '<option value=' + data[i].StoreId + ' Selected>' + data[i].StoreName + '</option>'

                    }
                }
                $('#Store').html(htmlstring).formSelect();


            },
            error: function (response) {
                M.toast({ html: "Something Went Wrong.", classes: 'rounded toast-danger' });
            },

        });
    }

    function GetProduct() {
        $.ajax({
            url: "/Invoice/GetProductList",
            type: "GET",
            success: function (data) {
                //debugger
                $('#product').empty();
                var htmlstring = '';

                htmlstring = '<option value="" disabled selected>Select Product</option>'
                if (data.length != 0) {
                    for (var i = 0; i < data.length; i++) {

                        htmlstring += '<option value=' + data[i].ProductId + ' Selected>' + data[i].ProductName + '</option>'

                    }
                }
                $('#product').html(htmlstring).formSelect();
                $('#product').on('change', function () {
                    var prodId = parseInt($('#product').val()) - 1;
                    //debugger
                    $('#productPrice1').val(data[prodId].ProductPrice);
                    var price = parseInt(data[prodId].ProductPrice);
                    var qty = parseInt($('#productqty1').val());
                    var total = price * qty;
                    $('#productTotal1').val(total);
                    ProductDetailChahnge(price)


                });

                function ProductDetailChahnge(price) {

                    $('#productqty1').on('change', function () {
                        debugger

                        var qty = parseInt($('#productqty1').val());
                        var total = price * qty;
                        $('#productTotal1').val(total);

                    });
                };



            },
            error: function (response) {
                M.toast({ html: "Something Went Wrong.", classes: 'rounded toast-danger' });
            },

        });
    }


    $(document).on("click", "#addInvoice1", function () {
        debugger

        var fileData = new FormData();
        fileData.append("CustomerId", parseInt($("#Customer").val()));
        fileData.append("StoreId", parseInt($("#Store").val()));
        fileData.append("Tax", $("#tax1").val());
        fileData.append("Discount", $("#discount1").val());


        $.ajax({
            type: 'post',
            url: '/Invoice/insert',
            data: fileData,
            contentType: false,
            processData: false,
            success: function (data) {
                debugger
                alert("success");
                if (data = "success") {
                    window.location.href = '/Invoice/index';
                }
                GetDataTableData()

            },
            error: function (err) {
                alert(err);
            }
        });

        clear()
        $('#modal1').modal('close');

    });

    function clear() {
        $("#Customer").val("")
        $("#Store").val("");
        $("#tax1").val("");
        $("#discount1").val("");

    }




</script>